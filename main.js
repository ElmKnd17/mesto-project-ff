(()=>{"use strict";var e="ebe2531e-a633-4ca4-9e9d-18db3ca8a83f",t={userUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-10/users/me",cardsUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-10/cards",headersTypeGet:{authorization:e},headers:{authorization:e,"Content-Type":"application/json"},patch:"PATCH",post:"POST",put:"PUT",delete:"DELETE"},r=function(e){return fetch("".concat(t.cardsUrl,"/likes/").concat(e),{method:t.put,headers:t.headersTypeGet}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))},o=function(e){return fetch("".concat(t.cardsUrl,"/likes/").concat(e),{method:t.delete,headers:t.headersTypeGet}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))},n=[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}];function c(e,t,r,o,n,c,a,u){var s=t.content.cloneNode(!0),i=s.querySelector(".card"),l=s.querySelector(".card__image"),p=s.querySelector(".card__title"),d=s.querySelector(".card__like-button"),_=s.querySelector(".card__delete-button"),f=s.querySelector(".card__like-counter"),m=0,y=!1;return e.likes&&(m=e.likes.length,Array.from(e.likes).forEach((function(e){y=e._id===c}))),y&&d.classList.add("card__like-button_is-active"),e._id&&i.setAttribute("id",e._id),l.src=e.link,l.alt='На фото изображено место "'.concat(e.name,'"'),p.textContent=e.name,f.textContent=m,d.setAttribute("aria-label","Поставить лайк"),d.addEventListener("click",(function(t){r(t,e,a,u)})),e.owner&&e.owner._id===c?(_.setAttribute("aria-label","Удалить место"),_.addEventListener("click",n)):_.remove(),l.addEventListener("click",o),s}function a(e,t){var n=e.target,c=n.closest(".card__like-container").querySelector(".card__like-counter");n.classList.contains("card__like-button_is-active")?(c.textContent=Number.parseInt(c.textContent)-1,o(t._id)):(c.textContent=Number.parseInt(c.textContent)+1,r(t._id)),n.classList.toggle("card__like-button_is-active")}function u(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened"),r=t.querySelector(".popup__close");p(t,r)}}function s(e){p(e.target.closest(".popup"),e.target)}function i(e){if(e.target===e.currentTarget){var t=e.target.querySelector(".popup__close");p(e.target,t)}}function l(e,t){e.classList.add("popup_is-opened"),e.addEventListener("click",i),t.addEventListener("click",s),document.addEventListener("keydown",u)}function p(e,t){e.classList.remove("popup_is-opened"),e.removeEventListener("click",i),t.removeEventListener("click",s),document.removeEventListener("keydown",u)}function d(e,t,r,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),n.textContent="",n.classList.remove(o)}function _(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r),t.removeAttribute("disabled")):(t.classList.add(r),t.setAttribute("disabled",!0))}function f(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((function(r){d(e,r,t.inputErrorClass,t.errorClass)})),_(r,o,t.inactiveButtonClass)}var m,y=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),h=v.querySelector(".popup__close"),S=v.querySelector(".popup__form"),k=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),g=S.querySelector(".popup__input_type_name"),C=S.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_edit-avatar"),x=E.querySelector(".popup__close"),L=E.querySelector(".popup__form"),j=L.querySelector(".popup__input"),A=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_new-card"),P=T.querySelector(".popup__close"),U=T.querySelector(".popup__form"),w=document.querySelector(".popup_type_image"),B=document.querySelector(".places__list"),G=document.querySelector("#card-template"),N=w.querySelector(".popup__image"),D=w.querySelector(".popup__caption"),I=w.querySelector(".popup__close"),O=U.querySelector(".popup__input_type_card-name"),z=U.querySelector(".popup__input_type_url"),J=document.querySelector(".popup_type_delete-card"),M=J.querySelector(".popup__close"),V=J.querySelector(".popup__form"),H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function F(e){var t=e.target.closest(".card").querySelector(".card__title");N.src=e.target.src,N.alt=e.target.alt,D.textContent=t.textContent,l(w,I)}function K(e){J.setAttribute("id",e.target.closest(".card").id),l(J,M)}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((function(n){n.addEventListener("input",(function(){_(r,o,t.inactiveButtonClass),function(e,t,r,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t,r,o):function(e,t,r,o,n){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=r,c.classList.add(n)}(e,t,t.validationMessage,r,o)}(e,n,t.inputErrorClass,t.errorClass)}))}))}(t,e)}))}(H),fetch(t.userUrl,{headers:t.headersTypeGet}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){m=e._id,k.textContent=e.name,q.textContent=e.about,b.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),y.addEventListener("click",(function(){l(v,h),g.value=k.textContent,C.value=q.textContent,f(S,H)})),A.addEventListener("click",(function(){l(T,P),U.reset(),f(U,H)})),fetch(t.cardsUrl,{headers:t.headersTypeGet}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){Array.from(e).forEach((function(e){B.append(c(e,G,a,F,K,m,r,o))}))})).catch((function(e){console.log(e),n.forEach((function(e){B.append(c(e,G,a,F,K,m,r,o))}))})),S.addEventListener("submit",(function(e){e.preventDefault();var r,o,n=e.target.querySelector(".button");n.textContent="Сохранение...",(r=g.value,o=C.value,fetch(t.userUrl,{method:t.patch,headers:t.headers,body:JSON.stringify({name:r,about:o})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){k.textContent=e.name,q.textContent=e.about,p(v,h),n.textContent="Сохранить"})).catch((function(e){console.log(e)}))})),U.addEventListener("submit",(function(e){e.preventDefault();var n,u,s=e.target.querySelector(".button");s.textContent="Сохранение...",(n=O.value,u=z.value,fetch(t.cardsUrl,{method:t.post,headers:t.headers,body:JSON.stringify({name:n,link:u})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){var t=e.name,n=e.link,u=e.owner._id,i=e._id;B.prepend(c({name:t,link:n,_id:i,owner:{_id:u}},G,a,F,K,m,r,o)),p(T,P),s.textContent="Сохранить"})).catch((function(e){console.log(e)}))})),V.addEventListener("submit",(function(e){e.preventDefault();var r,o=e.target.querySelector(".button");o.textContent="Удаление...",(r=J.id,fetch("".concat(t.cardsUrl,"/").concat(r),{method:t.delete,headers:t.headersTypeGet}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(){document.getElementById(J.id).remove(),J.removeAttribute("id"),o.textContent="Да",p(J,M)})).catch((function(e){console.log(e)}))})),b.addEventListener("click",(function(){l(E,x),f(L,H)})),L.addEventListener("submit",(function(e){e.preventDefault();var r,o=e.target.querySelector(".button");o.textContent="Сохранение...",(r=j.value,fetch("".concat(t.userUrl,"/avatar"),{method:t.patch,headers:t.headers,body:JSON.stringify({avatar:r})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){console.log(e.avatar),b.style.backgroundImage="url(".concat(e.avatar,")"),p(E,x),o.textContent="Сохранить"}))}))})();